<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brötchen-Bestellung</title>
<style>
body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#DFDCD7; color:#292826; }
h1 { font-size:1.4rem; margin-bottom:0.5em; }
.page { display:none; padding:20px; max-width:600px; margin:0 auto; }
.page.active { display:block; }
button { background:#292826; color:#fff; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; }
button[disabled] { opacity:0.6; cursor:not-allowed; }

.overlay,.success{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#ffffffee;z-index:9999}
.success .tick{max-width:520px;text-align:center}
.success .tick svg{width:86px !important;height:86px !important;display:block;margin:0 auto 14px}

.article { display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px solid #ccc; }
.article-name { flex:1; }
.article-price { width:70px; text-align:right; }

.footer { margin-top:20px; font-weight:bold; text-align:right; }

#loading-overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,0.8); z-index:9998; font-size:1.2rem; }
</style>
</head>
<body>

<script>
function sendHeight() {
  const height = document.body.scrollHeight;
  window.parent.postMessage({ type: "setHeight", height: height }, "*");
}
window.addEventListener("load", sendHeight);
window.addEventListener("resize", sendHeight);
</script>

<div id="seite1" class="page active">
  <h1>Persönliche Daten</h1>
  <label>Name:<br><input type="text" id="name"></label><br><br>
  <label>Email:<br><input type="email" id="email"></label><br><br>
  <label>Ferienwohnung:<br>
    <input type="radio" name="wohnung" value="Fewo1"> Fewo 1<br>
    <input type="radio" name="wohnung" value="Fewo2"> Fewo 2
  </label><br><br>
  <button onclick="gotoPage2()">Weiter</button>
</div>

<div id="seite2" class="page">
  <h1>Brötchen-Auswahl</h1>
  <div id="articles"></div>
  <div class="footer">Gesamt: <span id="gesamtpreis">0,00 €</span></div><br>
  <button id="btn-submit" onclick="submitForm()">Bestellung absenden</button>
</div>

<div id="loading-overlay">Bitte warten...</div>

<div id="success-container" class="success">
  <div class="tick">
    <svg viewBox="0 0 52 52">
      <path fill="none" stroke="#5cb85c" stroke-width="5" d="M14 27l7 7 17-17"/>
    </svg>
    <p>Bestellung erfolgreich!</p>
  </div>
</div>

<script>
const cfg = {
  googleAppScriptUrl: 'https://script.google.com/macros/s/AKfycbwvmcUgZOhCh9inZgTPqcybrk6-cHzbU2z50HcPWUoBFDNWbtiP-3Tq5cPi0TD-2kHn/exec'
};

const artikel = [
  ["Müslibrötchen", 1.50],
  ["Roggenkrüsti", 0.99],
  ["Fitnessbrötchen", 1.15],
  ["Kürbiskernbrötchen", 1.20],
  ["Dinkelbrötchen", 1.20],
  ["Schnittbrötchen", 0.60],
  ["Kraftkörnchen", 1.15],
  ["Mohnbrötchen", 0.85],
  ["Sesambrötchen", 0.85],
  ["Morgengoldbrötchen", 0.95],
  ["Kartoffelbrötchen", 1.05],
  ["Kürbiskäsebrötchen", 1.60],
  ["Käsebrötchen", 1.55],
  ["Milchbrötchen", 1.00],
  ["Rosinenbrötchen", 1.10],
  ["Buttercroissant", 1.85],
  ["Croissant", 1.85],
  ["Schokoladencroissant", 2.10],
  ["Laugenstange", 1.60],
  ["Laugenbrötchen", 1.20],
  ["Rosinenschnecke", 2.45],
  ["Donut", 1.85],
  ["Berliner", 1.80],
  ["Mandelhörnchen", 2.80],
  ["großes Kassler", 4.55],
  ["Kraftkornbrot", 4.85],
  ["Münsterländer", 4.50],
  ["Fitnessbrot", 4.85],
  ["Dinkelbrot", 4.55],
  ["Steinofenbrot", 4.55],
  ["Holzhacker", 4.85],
  ["Hamburger Brot", 3.70],
  ["Pottstuten", 4.50]
];

function renderArticles(){
  const wrap = document.getElementById('articles');
  wrap.innerHTML = '';
  artikel.forEach(([name, price])=>{
    const div = document.createElement('div');
    div.className = 'article';
    div.innerHTML = `<span class="article-name">${name}</span>
      <span class="article-price">${price.toFixed(2).replace('.',',')} €</span>`;
    wrap.appendChild(div);
  });
}

function gotoPage2(){
  document.getElementById('seite1').classList.remove('active');
  document.getElementById('seite2').classList.add('active');
  renderArticles();
  sendHeight();
}

let isSubmitting = false;
async function submitForm(){
  if(isSubmitting) return;
  isSubmitting = true;
  const btn = document.getElementById('btn-submit');
  btn.disabled = true;

  const payload = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    wohnung: (document.querySelector('input[name="wohnung"]:checked')||{}).value || '',
    bestellungen: artikel,
    gesamtpreis_client: document.getElementById('gesamtpreis').textContent
  };

  document.getElementById('loading-overlay').style.display='flex';
  try{
    await fetch(cfg.googleAppScriptUrl, {
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify(payload)
    });
    document.getElementById('loading-overlay').style.display='none';
    document.getElementById('seite1').style.display='none';
    document.getElementById('seite2').style.display='none';
    document.getElementById('success-container').style.display='flex';
    sendHeight();
  }catch(e){
    console.error(e);
    alert('Fehler beim Absenden.');
  }finally{
    isSubmitting = false;
    btn.disabled = false;
  }
}
</script>
</body>
</html>
